{% extends 'base_accounting.html' %}

{% block title %}CONCILIACIONES - Ítems de Órdenes de Compra{% endblock %}

{% block content %}
<div class="container-fluid">
    <header class="bg-light p-4 rounded shadow-sm mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="mb-0 fw-bold text-primary" style="font-size: 1.7rem;">
                <i class="fas fa-exchange-alt"></i> Conciliaciones de Órdenes de Compra y Extractos Bancarios
            </h2>
            <div class="d-flex justify-content-end gap-2">
                <button onclick="exportToExcel()" class="btn btn-outline-success">
                    <i class="fas fa-file-excel"></i> Descargar Excel
                </button>
                <button onclick="exportToPDF()" class="btn btn-outline-danger">
                    <i class="fas fa-file-pdf"></i> Descargar PDF
                </button>
            </div>
        </div>

        <!-- Formulario de filtros entre fechas -->
        <form method="GET" class="row g-2 mt-3">
            <div class="col-auto">
                <label for="start_date" class="visually-hidden">Desde:</label>
                <input type="date" name="start_date" id="start_date" class="form-control" value="{{ start_date }}">
            </div>
            <div class="col-auto">
                <label for="end_date" class="visually-hidden">Hasta:</label>
                <input type="date" name="end_date" id="end_date" class="form-control" value="{{ end_date }}">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter"></i> Filtrar
                </button>
            </div>
            <div class="col-auto">
                <a href="{% url 'purchase_conciliations' %}" class="btn btn-secondary">
                    <i class="fas fa-redo"></i> Limpiar
                </a>
            </div>
        </form>
    </header>

    <div class="row mt-4">
        <!-- Tabla de Ítems de Órdenes de Compra -->
        <div class="col-md-6">
            <h3 class="fw-bold text-center text-primary">Ítems de Órdenes de Compra</h3>
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th>Monto</th>
                            <th>Banco</th>
                            <th>Cuenta Depositada</th>
                            <th>Moneda</th>
                            <th>Fecha Pagada</th>
                            <th>N. Movimiento</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if items %}
                            {% for item in items %}
                            <tr>
                                <td>{{ item.price_total }}</td>
                                <td>{{ item.supplier.bank }}</td>
                                <td>{{ item.supplier.name }}</td>
                                <td>{{ item.supplier.currency }}</td>
                                <td>{{ item.purchaseorder.scheduled_date }}</td>
                                <td>{{ item.mov_number }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="text-center text-muted">No hay ítems para mostrar</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tabla de Extractos Bancarios -->
        <div class="col-md-6">
            <h3 class="fw-bold text-center text-primary">Extractos Bancarios</h3>
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover">
                    <thead class="bg-info text-white">
                        <tr>
                            <th>Monto</th>
                            <th>Banco</th>
                            <th>F. Operación</th>
                            <th>Referencia</th>

                            <th>N. Movimiento</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if bank_statements %}
                            {% for statement in bank_statements %}
                            <tr>
                                <td>{{ statement.amount }}</td>
                                <td>{{ statement.bank.bank_name }}</td>
                                <td>{{ statement.operation_date }}</td>
                                <td>{{ statement.reference }}</td>
                                <td>{{ statement.number_moviment }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">No hay extractos bancarios para mostrar</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function exportToPDF() {
        alert('Exportar a PDF');
        // Aquí va la lógica para exportar a PDF
    }

    function exportToExcel() {
        alert('Exportar a Excel');
        // Aquí va la lógica para exportar a Excel
    }
</script>
{% endblock %}
